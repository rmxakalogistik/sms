<section id="userDialog" matDialogContainer>


  <mat-toolbar id="mat-toolbar" class="navigation-toolbar" [ngStyle.lt-sm]="{'height': '50px'}"
    [class.navigation-is-mobile]="mobileQuery.matches" [class.mat-elevation-z0]="!isActive"
    [class.mat-elevation-z8]="isActive" [class.animated-header]="!isActivefadeInDown"
    [class.fadeInDown]="!isActivefadeInDown" [class.navigation-fixed]="!fixedTolbar">
    <div class="dialog-action" fxLayout="column">
      <div class="dialog-action" fxLayout="row">
        <button id="menubutton" mat-icon-button (click)="close()" style="color:white;">
          <mat-icon fontSet="material-icons-outlined">chevron_left</mat-icon>
        </button>
        <button mat-button style="color:white;line-height: normal;text-align: left;">
          <span *ngIf="!local_data.isReservation"
            style="vertical-align:middle !important;padding: 5px 5px 5px 0;font-size: 12px;">{{action|uppercase}}<br />D'UN
            UTILISATEUR</span>
            <span *ngIf="local_data.isReservation"
            style="vertical-align:middle !important;padding: 5px 5px 5px 0;font-size: 12px;">{{action|uppercase}}<br />D'UN
            VOYAGEUR</span>
        </button>
        <span class="navigation-spacer"></span>
        <button mat-button style="color:white;line-height: normal;text-align: left;" *ngIf="canMoveNext()&&!loading"
          matTooltip="Enregistrer" [matTooltipPosition]="'below'" (click)="confirm(formData.value)">
          <span style="vertical-align:middle !important;font-size: 12px;"
            *ngIf="action != 'Suppression'">ENREGISTRER</span>
          <span style="vertical-align:middle !important;font-size: 12px;"
            *ngIf="action == 'Suppression'">SUPPRIMER</span>
          <mat-icon fontSet="material-icons-outlined">check</mat-icon>
        </button>
      </div>
    </div>
  </mat-toolbar>
  <div class="navigation-empty" fxShow="false" fxShow.gt-xs="true"></div>

  <div style="padding-top:4rem;" (onScroll)="detectScroll($event)">

    <div fxLayout="column" fxLayoutAlign="center center" class="dialog-action" style="min-height:100px;margin-top:3rem;"
      *ngIf="loading">
      <div color="warn" style="text-align:center;">
        <small><b>Opération en cours.<br />Veuillez patienter s'il vous plait.</b></small>
      </div>
      <mat-spinner color="primary" [diameter]="40"></mat-spinner>
    </div>


    <mat-tab-group *ngIf="!loading" [formGroup]="formData" appDisableAutofill class="app-mat-tab">
      <mat-tab>
        <ng-template mat-tab-label>
          Infos
        </ng-template>
        <div class="dialog-form-main" style="padding-top:1rem;padding-bottom:30rem;" (onScroll)="detectScroll($event)">

          <div fxLayout="column" fxLayoutAlign="start center" class="form-contain">

            <div fxLayout="row wrap" fxLayoutAlign="start start">

              <div style="width: 100%;padding: 0.3rem .3rem;" *ngIf="(!local_data.isReservation)&&!(local_data&&local_data.id)&&!(this.action == 'Création' && this.local_data.station)">

                <label>Choisir un type de compte</label>
                <mat-radio-group aria-label="Choisir un type de compte" class="form-radio-group"
                  [formControl]="formData.get('isStation')" color="primary">
                  <mat-radio-button class="form-radio-button" value="0">Back-office</mat-radio-button>
                  <mat-radio-button class="form-radio-button" value="1">Station-agent</mat-radio-button>
                </mat-radio-group>

              </div>
              <div fxLayout="column" *ngIf="local_data&&local_data.id&&action != 'Suppression'" style="width: 100%;padding: 0.3rem .3rem;">

                <mat-checkbox [formControl]="formData.get('reInitPassword')" color="primary">
                  Réinitialiser le mot de passe (<b>1234</b>)
                </mat-checkbox>

                <mat-checkbox *ngIf="(local_data.id !== user.id)" [formControl]="formData.get('reInitAutorisation')"
                  color="primary">
                  Réinitialiser les autorisations
                </mat-checkbox>

                <mat-checkbox *ngIf="(local_data.id !== user.id)" [formControl]="formData.get('isActive')"
                  [labelPosition]="'after'" color="primary">
                  <span *ngIf="formData.get('isActive').value!=true">Ce compte est bloqué</span>
                  <span *ngIf="formData.get('isActive').value==true">Ce compte est actif</span>
                </mat-checkbox>

              </div>

              <mat-form-field *ngIf="formData.get('isStation')?.value=='1'" appearance="fill" color="primary"
                (focus)="!(this.action == 'Création' && this.local_data.station)&&selectionDialog('station', {})" (click)="!(this.action == 'Création' && this.local_data.station)&&selectionDialog('station', {})">
                <mat-label>Choix de la station </mat-label>
                <input appDisableAutofill [disabled]="(this.action == 'Création' && this.local_data.station)" matInput readonly type="text" [required]="isRequiredField('station')"
                  autocomplete="new-station" [value]="formData.get('station').value?.title" [errorStateMatcher]="matcher">
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('station'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>Nom de famille </mat-label>
                <input appDisableAutofill matInput type="text" autocomplete="new-lastName"
                  [required]="isRequiredField('lastName')" [formControl]="formData.get('lastName')"
                  [errorStateMatcher]="matcher">
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('lastName'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>Post-nom </mat-label>
                <input appDisableAutofill matInput type="text" autocomplete="new-middleName"
                  [required]="isRequiredField('middleName')" [formControl]="formData.get('middleName')"
                  [errorStateMatcher]="matcher">
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('middleName'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>Prénom </mat-label>
                <input appDisableAutofill matInput type="text" autocomplete="new-firstName"
                  [required]="isRequiredField('firstName')" [formControl]="formData.get('firstName')"
                  [errorStateMatcher]="matcher">
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('firstName'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>Sexe </mat-label>
                <mat-select [required]="isRequiredField('gender')" [formControl]="formData.get('gender')"
                  [errorStateMatcher]="matcher">
                  <mat-option *ngFor="let item of genders" [value]="item">{{item}}</mat-option>
                </mat-select>
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('gender'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill"  (click)="picker.open()" style="cursor: pointer;">
                <mat-label>Date de naissance </mat-label>
                <input appDisableAutofill matInput autocomplete="new-bithdate" [max]="maxDate" [matDatepicker]="picker"
                  [required]="isRequiredField('bithdate')" readonly [formControl]="formData.get('bithdate')"
                  [errorStateMatcher]="matcher">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('bithdate'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>N° de téléphone </mat-label>
                <input appDisableAutofill matInput type="number" autocomplete="new-phone"
                  [required]="isRequiredField('phone')"
                  placeholder="{{ formData.value.country?formData.value.country.sample_phone:'n° de téléphone' }}"
                  [formControl]="formData.get('phone')" [errorStateMatcher]="matcher">
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('phone'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>Addresse email </mat-label>
                <input appDisableAutofill matInput type="text" autocomplete="new-email"
                  [required]="isRequiredField('email')" [formControl]="formData.get('email')"
                  [errorStateMatcher]="matcher">
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('email'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

              <mat-form-field color="primary" appearance="fill">
                <mat-label>Addresse du domicile </mat-label>
                <textarea appDisableAutofill matInput autocomplete="new-addresse" 
                [required]="isRequiredField('addresse')"
                [formControl]="formData.get('addresse')"
                [errorStateMatcher]="matcher"
                        cdkTextareaAutosize
                        cdkAutosizeMinRows="1"
                        cdkAutosizeMaxRows="5"
                        [errorStateMatcher]="matcher"></textarea>
                <mat-error>
                  <ng-container *ngFor="let error of errors(formData.get('addresse'))">
                    <small>{{ errorMessages[error] }} <br></small>
                  </ng-container>
                </mat-error>
              </mat-form-field>

            </div>

          </div>

        </div>
      </mat-tab>

    </mat-tab-group>

  </div>

  <div class="fab-center-container" fxLayout="row" fxLayoutAlign="center center">
    <div class="fab-container">
      <button color="primary" mat-fab class="fab-toggler" *ngIf="canMoveNext()&&!loading"
        (click)="confirm(formData.value)">
        <i class="material-icons" color="accent">check</i>
      </button>
      <button mat-fab color="primary" class="fab-toggler" *ngIf="loading">
        <mat-spinner color="accent" [diameter]="25"></mat-spinner>
      </button>
    </div>
  </div>

</section>